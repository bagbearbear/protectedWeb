<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderMapper">
	<resultMap type="order" id="orderSelectMap">
		<result property="orderNo" 			column="order_no" 			jdbcType="NUMERIC"/>
		<result property="prodNo" 			column="prod_no" 			jdbcType="NUMERIC" />
		<result property="id" 				column="id" 				jdbcType="VARCHAR"/>
		<result property="phone" 			column="phone" 				jdbcType="VARCHAR" />
		<result property="receiverAdder" 	column="receiver_addr" 		jdbcType="VARCHAR" />
		<result property="receiverName" 	column="receiver_name" 		jdbcType="VARCHAR" />
		<result property="receiverPhone" 	column="receiver_phone"	 	jdbcType="VARCHAR" />
		<result property="orderRequest" 	column="order_request" 		jdbcType="VARCHAR" />
		<result property="paymentCode" 		column="payment_code" 		jdbcType="NUMERIC" />
		<result property="orderQuantity" 	column="order_quantity" 	jdbcType="NUMERIC"/>
		<result property="totalPrice" 		column="total_price" 		jdbcType="NUMERIC" />
		<result property="orderCode" 		column ="order_code" 		jdbcType="NUMERIC"/>
		<!-- NULL가능  0-->
		<result property="deliveryCode" 	column="delivery_code" 		jdbcType="NUMERIC"/>
		<!-- NULL가능이지만 외래키■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■-->
		<result property="mileageNo"		column="mileage_no"			jdbcType="NUMERIC"/>
		<result property="couponNo"			column="coupon_no"			jdbcType="NUMERIC"/>
		<result property="orderDate"		column="order_date" 		jdbcType="DATE"/>
 
 </resultMap>




<insert id="addOrder" parameterType="order">
<selectKey keyProperty="orderNo" resultType="int" order="BEFORE">
		SELECT SEQ_ORDERS_ORDER_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT 
		INTO ORDERS 
		(ORDER_NO, PROD_NO, PHONE, ID, RECEIVER_ADDR, RECEIVER_NAME, 
		RECEIVER_PHONE, ORDER_REQUEST, PAYMENT_CODE, ORDER_DATE, 
		ORDER_QUANTITY, ORDER_CODE, TOTAL_PRICE, COUPON_NO, MILEAGE_NO) 
		VALUES (#{orderNo:NUMERIC}, #{prodNo:NUMERIC}, #{phone:VARCHAR}, #{id:VARCHAR}, 
		#{receiverAddr:VARCHAR}, #{receiverName:VARCHAR},#{receiverPhone:VARCHAR}, #{orderRequest:VARCHAR}, 
		#{paymentCode:NUMERIC}, SYSDATE, #{orderQuantity:NUMERIC}, #{orderCode:NUMERIC}, #{totalPrice:NUMERIC}, 
		#{couponNo:NUMERIC}, #{mileageNo:NUMERIC})
	</insert>

<select id="getOrder" parameterType="string" resultMap="orderSelectMap">
		SELECT o.order_no, o.prod_no, p.prod_name, o.id, o.receiver_name, 
		o.receiver_phone, o.receiver_addr, o.order_request, o.payment_code, 
		o.order_date, o.order_code, o.order_quantity, o.total_price

		FROM orders o, product p
		WHERE o.order_no = #{orderNo}
		AND o.prod_no = p.prod_no;
	</select>


	 <update id="updateOrderCode" parameterType="order" >
	UPDATE orders 
	SET
	order_code = #{orderCode}
	WHERE order_no = #{orderNo}
	</update>
	
	<update id="updateOrder" parameterType="order">
	UPDATE orders
	SET
	receiver_name = #{receiverName}, 
	receiver_phone = #{receiverPhone}, 
	receiver_addr = #{receiverAddr},
	order_request = #{orderRequest}
	WHERE order_no = #{orderNo}
	</update>
	
	<delete id="delOrder" parameterType="order">
	DELETE FROM orders
	WHERE tran_no = #{tranNo}
	</delete>

	 <select  id="listOrder"  parameterType="map"	resultMap="orderSelectMap">
	  	SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  		FROM (	SELECT order_no, prod_no, payment_code, order_date, total_price, order_code ,id
			from orders
					WHERE id =#{id}				
					ORDER BY order_no) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	 </select>
	 


	<select id="getTotalCount" parameterType="map" resultType="int">
		SELECT COUNT(*)
		FROM(SELECT * FROM orders) countTable
		</select>
		
	
		</mapper>