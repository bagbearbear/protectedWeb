<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderMapper">
	<resultMap type="order" id="orderSelectMap">
		<result property="orderNo" 			column="order_no" 			jdbcType="NUMERIC"/>
		<result property="prodNo" 			column="prod_no" 			jdbcType="NUMERIC" />
		<result property="id" 				column="id" 				jdbcType="VARCHAR"/>
		<result property="phone" 			column="phone" 				jdbcType="VARCHAR" />
		<result property="receiverAdder" 	column="receiver_addr" 		jdbcType="VARCHAR" />
		<result property="receiverName" 	column="receiver_name" 		jdbcType="VARCHAR" />
		<result property="receiverPhone" 	column="receiver_phone"	 	jdbcType="VARCHAR" />
		<result property="orderRequest" 	column="order_request" 		jdbcType="VARCHAR" />
		<result property="paymentCode" 		column="payment_code" 		jdbcType="NUMERIC" />
		<result property="orderDate"		column="order_date" 		jdbcType="DATE"/>
		<result property="orderQuantity" 	column="order_quantity" 	jdbcType="NUMERIC"/>
		<result property="totalPrice" 		column="total_price" 		jdbcType="NUMERIC" />
		<result property="orderCode" 		column ="order_code" 		jdbcType="NUMERIC"/>
		<result property="deliveryCode" 	column="delivery_code" 		jdbcType="NUMERIC"/>
		<result property="mileageNo"		column="mileage_no"			jdbcType="NUMERIC"/>
		<result property="couponNo"			column="coupon_no"			jdbcType="NUMERIC"/>
</resultMap>



<insert id="addOrder" parameterType="order">
<selectKey keyProperty="orderNo" resultType="int" order="BEFORE">
		SELECT SEQ_ORDERS_ORDER_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO ORDERS (ORDER_NO, PROD_NO, PHONE, ID, RECEIVER_ADDR, RECEIVER_NAME, 
		RECEIVER_PHONE, ORDER_REQUEST, PAYMENT_CODE, ORDER_DATE, 
		ORDER_QUANTITY, ORDER_CODE, TOTAL_PRICE, DELIVERY_CODE, COUPON_NO, MILEAGE_NO) 
		VALUES
		#{orderNo},
		#{prodNo},
		#{phone},
		#{id},
		#{receiverAddr},
		#{receiverName},
		#{receiverPhone},
		#{orderRequest},
		#{paymentCode},
		SYSDATE,
		#{orderQuantity},
		#{orderCode},
		#{totalPrice},
		#{deliveryCode},
		#{couponNo},
		#{mileageNo}
		)
	</insert>

<select id="getOrder" parameterType="string" resultMap="orderSelectMap">
		SELECT o.order_no, o.prod_no, p.prod_name, o.id, o.receiver_name, 
		o.receiver_phone, o.receiver_addr, o.order_request, o.payment_code, 
		o.order_date, o.order_code, o.order_quantity, o.total_price

		FROM orders o, product p
		WHERE o.order_no = #{orderNo}
		AND o.prod_no = p.prod_no;
	</select>


	 <update id="updateOrderCode" parameterType="order" >
	UPDATE orders 
	SET
	order_code = #{orderCode}
	WHERE order_no = #{orderNo}
	</update>
	
	<update id="updateOrder" parameterType="order">
	UPDATE orders
	SET
	receiver_name = #{receiverName}, 
	receiver_phone = #{receiverPhone}, 
	receiver_addr = #{receiverAddr},
	order_request = #{orderRequest}
	WHERE order_no = #{orderNo}
	</update>
	
	<delete id="delOrder" parameterType="order">
	DELETE FROM orders
	WHERE tran_no = #{tranNo}
	</delete>

	 <select  id="listOrder"  parameterType="search"	resultMap="orderSelectMap">
	  	SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  		FROM (	SELECT order_no , prod_no , total_price, order_code
					FROM orders ,
					WHERE id =#{id}					
					ORDER BY order_no) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	 </select>
	 
	 <select  id="listAdminOrder"  parameterType="search"	resultMap="orderSelectMap">
	  	SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  		FROM (	SELECT order_no, reg_date, id, order_quantity, payment_code, total_price, order_code, delivery_code
					FROM orders
					WHERE id =#{id}					
					ORDER BY order_no) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	 </select>
	 
	 <select  id="listSwapOrder"  parameterType="search"	resultMap="orderSelectMap">
	  	SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  		FROM (	SELECT order_no , prod_no , total_price, order_code
					FROM orders
					WHERE id =#{id}					
					ORDER BY order_no) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	 </select>
	 


	<select id="getTotalCount" parameterType="search" resultType="int">
		SELECT COUNT(*)
		FROM(SELECT * FROM orders) countTable
		</select>
		
	
		</mapper>